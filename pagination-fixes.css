/**
 * CSS Fixes for BMPOA Document Pagination
 * Resolves overflow and orphan issues
 */

/* Enhanced Page Break Control */
@media print {
    /* Prevent orphaned headers - CRITICAL */
    h2, h3, h4, h5, h6 {
        page-break-after: avoid !important;
        break-after: avoid !important;
        page-break-inside: avoid !important;
        break-inside: avoid !important;
    }
    
    /* Ensure content follows headers - keep at least 4 lines */
    h2 + *, h3 + *, h4 + * {
        page-break-before: avoid !important;
        break-before: avoid !important;
        min-height: 3em;
    }
    
    /* Keep header with its following content block */
    h2:has(+ *), h3:has(+ *), h4:has(+ *) {
        display: table;
        width: 100%;
    }
    
    /* Keep related content together */
    .keep-together {
        page-break-inside: avoid;
        break-inside: avoid;
    }
    
    /* Prevent widows and orphans */
    p {
        orphans: 3;
        widows: 3;
    }
    
    /* Keep short lists together */
    ul, ol {
        page-break-inside: auto;
    }
    
    ul li:first-child,
    ol li:first-child {
        page-break-before: avoid;
    }
    
    ul li:last-child,
    ol li:last-child {
        page-break-after: avoid;
    }
    
    /* Table handling */
    table {
        page-break-inside: avoid;
        break-inside: avoid;
    }
    
    tr {
        page-break-inside: avoid;
        break-inside: avoid;
    }
    
    /* Image handling */
    img {
        page-break-inside: avoid;
        break-inside: avoid;
        page-break-after: avoid;
        max-height: 8in; /* Prevent images from exceeding page height */
    }
    
    /* Alert boxes and special content */
    .alert-box, .warning-box, .info-box {
        page-break-inside: avoid;
        break-inside: avoid;
        margin-bottom: 1em;
    }
}

/* Optimize spacing for 20-page target - AGGRESSIVE */
.page-content {
    /* Tighter line spacing */
    line-height: 1.4 !important; /* Further reduced */
}

/* Reduce margins and padding - MORE AGGRESSIVE */
.page-content h2 {
    margin-top: 0.8em !important; /* Much less space */
    margin-bottom: 0.4em !important; 
    font-size: 1.6em !important; /* Smaller */
    page-break-after: avoid !important;
}

.page-content h3 {
    margin-top: 0.6em !important; 
    margin-bottom: 0.3em !important;
    font-size: 1.2em !important; /* Smaller */
    page-break-after: avoid !important;
}

.page-content h4 {
    margin-top: 0.5em !important;
    margin-bottom: 0.25em !important;
    font-size: 1em !important; /* Smaller */
    page-break-after: avoid !important;
}

.page-content p {
    margin-bottom: 0.8em; /* Reduced from 1em */
}

.page-content ul,
.page-content ol {
    margin-bottom: 0.8em; /* Reduced from 1em */
    padding-left: 1.5em; /* Reduced from 2em */
}

.page-content li {
    margin-bottom: 0.3em; /* Reduced from 0.5em */
}

/* Optimize table spacing */
.page-content table {
    margin: 0.8em 0; /* Reduced from 1em */
    font-size: 0.95em; /* Slightly smaller */
}

.page-content th,
.page-content td {
    padding: 0.4em 0.6em; /* Reduced from 0.5em 0.8em */
}

/* Two-column layout optimization */
.two-column {
    column-gap: 1.5em; /* Reduced from 2em */
}

/* Zone detail boxes */
.zone-detail {
    padding: 0.8em !important; /* Reduced from 1em */
    margin-bottom: 0.8em !important; /* Reduced from 1em */
}

/* Contact cards */
.contact-card {
    padding: 0.8em; /* Reduced from 1em */
    margin-bottom: 0.8em; /* Reduced from 1em */
}

/* Emergency contact boxes */
.emergency-contact {
    padding: 1em; /* Reduced from 1.5em */
    margin: 0.8em 0; /* Reduced from 1em */
}

/* Section containers */
.section {
    margin-bottom: 1.5em; /* Reduced from 2em */
}

/* Special handling for specific pages */

/* Table of Contents - More compact */
.toc-section {
    margin-bottom: 0.8em; /* Reduced spacing */
}

.toc-section ul {
    margin: 0.3em 0; /* Tighter spacing */
}

.toc-section li {
    margin-bottom: 0.2em; /* Minimal spacing */
    line-height: 1.3; /* Tighter lines */
}

/* Chapter start pages - Remove excess space */
.page[data-template="chapter-start"] .page-content {
    padding-top: 20%; /* Reduced from 30% */
}

/* Committee tables - More compact */
.committee-table td {
    padding: 0.3em 0.5em; /* Reduced padding */
    font-size: 0.9em; /* Smaller text */
}

/* Consolidation helpers */
.can-break {
    page-break-inside: auto;
    break-inside: auto;
}

.prefer-break-before {
    page-break-before: auto;
    break-before: auto;
}

/* Fix for overflow content */
.page-content {
    overflow: hidden;
    word-wrap: break-word;
    word-break: break-word;
    max-height: calc(var(--content-height) - 0.5in) !important;
}

/* Force tables to stay together */
table {
    page-break-inside: avoid !important;
    break-inside: avoid !important;
    display: table !important;
}

table thead {
    display: table-header-group !important;
}

table tbody {
    display: table-row-group !important;
}

table tr {
    page-break-inside: avoid !important;
    break-inside: avoid !important;
}

/* If table must break, repeat header */
@media print {
    thead {
        display: table-header-group !important;
    }
}

/* Ensure footer stays at bottom */
.page-footer {
    position: absolute;
    bottom: 0.5in;
    left: 0.75in;
    right: 0.75in;
    z-index: 100;
}

/* Add automatic page breaks before sections that are too large */
.page-content > h2:nth-of-type(3n) {
    page-break-before: auto;
}

/* Keep critical sections together */
.emergency-contact,
.contact-card,
.zone-detail,
.service-provider,
.evacuation-zone {
    page-break-inside: avoid !important;
    break-inside: avoid !important;
}

/* Debug helpers - Remove in production */
.overflow-indicator {
    position: absolute;
    right: 0;
    top: 0;
    width: 10px;
    height: 100%;
    background: repeating-linear-gradient(
        45deg,
        #ff0000,
        #ff0000 10px,
        #ffffff 10px,
        #ffffff 20px
    );
    opacity: 0.3;
    pointer-events: none;
}